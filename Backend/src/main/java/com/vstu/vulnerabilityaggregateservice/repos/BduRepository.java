package com.vstu.vulnerabilityaggregateservice.repos;

import com.vstu.vulnerabilityaggregateservice.entityes.Bdu;
import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.data.jpa.repository.JpaSpecificationExecutor;
import org.springframework.stereotype.Repository;

import javax.persistence.criteria.Predicate;
import java.util.List;
import java.util.Optional;

@Repository
public interface BduRepository extends JpaRepository<Bdu, Long>, JpaSpecificationExecutor<Bdu> {
    Optional<Bdu> findByBduId(String bduId);

    Optional<Bdu> findByOtherSystemsIdentifiersContaining(String substring);

    default List<Bdu> findBduWhereFieldContainsAnyOfWords(List<String> words) {
        return findAll((root, query, cb) -> {
            Predicate predicate = cb.disjunction();
            for (String word : words) {
                predicate = cb.or(predicate, cb.like(cb.lower(root.get("otherSystemsIdentifiers")), "%" + word.toLowerCase() + "%"));
            }
            return predicate;
        });
    }
}
